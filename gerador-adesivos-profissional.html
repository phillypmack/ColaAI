<!DOCTYPE html>
<html class="dark" lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HardSkills - Gerador de Adesivos DTF UV</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: #131022;
            color: #e5e7eb;
            overflow-x: hidden;
        }

        .main-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            height: 100vh;
            gap: 0;
        }

        .sidebar {
            background: #1e1933;
            border-right: 1px solid #2d2640;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            padding: 20px;
        }

        .header {
            padding: 20px;
            border-bottom: 1px solid #2d2640;
        }

        .stat-card {
            background: #2a2440;
            border: 1px solid #3d3654;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .config-section {
            padding: 20px;
            border-bottom: 1px solid #2d2640;
        }

        .icon-card {
            background: #1e1933;
            border: 2px solid #2d2640;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            position: relative;
        }

        .icon-card:hover {
            border-color: #4b2bee;
            background: #251f3d;
        }

        .icon-card.selected {
            border-color: #4b2bee;
            background: rgba(75, 43, 238, 0.1);
        }

        .icon-card img {
            width: 48px;
            height: 48px;
            object-fit: contain;
        }

        .category-header {
            background: #2a2440;
            border: 1px solid #3d3654;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-size: 14px;
        }

        .btn-primary {
            background: #4b2bee;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #3d24be;
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #2a2440;
            color: #4b2bee;
            border: 1px solid #3d3654;
        }

        .btn-secondary:hover {
            background: #342d50;
        }

        .preview-box {
            background: white;
            border-radius: 8px;
            padding: 16px;
            aspect-ratio: 210 / 297;
            display: flex;
            align-items: center;
            justify-content: center;
            max-height: 400px;
        }

        .loading-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #2d2640;
            border-top-color: #4b2bee;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        input[type="number"],
        select {
            background: linear-gradient(135deg, #2a2440 0%, #342d50 100%);
            border: 1px solid #4b2bee;
            color: white;
            padding: 10px 14px;
            border-radius: 8px;
            width: 100%;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        select {
            background-image: linear-gradient(135deg, #2a2440 0%, #342d50 100%);
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            padding-right: 35px;
        }

        select:hover {
            border-color: #5d3aff;
            box-shadow: 0 0 0 3px rgba(75, 43, 238, 0.1);
        }

        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #5d3aff;
            box-shadow: 0 0 0 3px rgba(75, 43, 238, 0.2);
        }

        select option {
            background: #1e1933;
            color: #000000;
            padding: 10px;
            font-weight: 500;
        }

        .search-input {
            background: #2a2440;
            border: 1px solid #3d3654;
            color: white;
            padding: 10px 16px;
            border-radius: 6px;
            width: 100%;
            font-size: 14px;
        }

        .search-input:focus {
            outline: none;
            border-color: #4b2bee;
        }

        .search-input::placeholder {
            color: #888;
        }

        .action-panel {
            padding: 20px;
            background: #1e1933;
            border-top: 1px solid #2d2640;
        }

        .quantity-input {
            display: none;
            margin-top: 8px;
        }

        .icon-card.selected .quantity-input {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: fixed;
                top: 0;
                left: -350px;
                height: 100vh;
                width: 350px;
                z-index: 1000;
                transition: left 0.3s;
            }

            .sidebar.open {
                left: 0;
            }
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#4b2bee",
                    },
                },
            },
        }
    </script>
</head>

<body>
    <!-- Sidebar -->
    <div class="main-container">
        <div class="sidebar">
            <!-- Header -->
            <div class="header">
                <h1 class="text-2xl font-bold text-white mb-1">HardSkills</h1>
                <p class="text-xs text-gray-400">Gerador DTF UV 3D</p>
            </div>

            <!-- Stats -->
            <div class="config-section">
                <div class="grid grid-cols-4 gap-2">
                    <div class="stat-card">
                        <div class="text-xs text-gray-400">√önicos</div>
                        <div id="selectedIcons" class="text-lg font-bold text-primary">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="text-xs text-gray-400">Total</div>
                        <div id="totalStickers" class="text-lg font-bold text-primary">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="text-xs text-gray-400">P/Folha</div>
                        <div id="maxFit" class="text-lg font-bold text-primary">48</div>
                    </div>
                    <div class="stat-card">
                        <div class="text-xs text-gray-400">Folhas</div>
                        <div id="sheetsNeeded" class="text-lg font-bold text-primary">0</div>
                    </div>
                </div>
            </div>

            <!-- Configura√ß√µes -->
            <div class="config-section">
                <h3 class="text-sm font-bold text-gray-300 mb-3">Configura√ß√µes</h3>
                <div class="space-y-3">
                    <div>
                        <label class="text-xs text-gray-400 mb-1 block">Tamanho</label>
                        <select id="stickerSize" onchange="updateStats()">
                            <option value="10">10mm</option>
                            <option value="25">25mm</option>
                            <option value="30" selected>30mm</option>
                            <option value="35">35mm</option>
                            <option value="40">40mm</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs text-gray-400 mb-1 block">Espa√ßamento</label>
                        <select id="spacing" onchange="updateStats()">
                            <option value="5">5mm</option>
                            <option value="10" selected>10mm</option>
                            <option value="15">15mm</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs text-gray-400 mb-1 block">Forma</label>
                        <select id="stickerShape" onchange="updatePreview()">
                            <option value="circle" selected>C√≠rculo</option>
                            <option value="square">Quadrado</option>
                            <option value="rounded">Arredondado</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Preview -->
            <div class="config-section flex-1 flex flex-col">
                <h3 class="text-sm font-bold text-gray-300 mb-3">Preview (Cores)</h3>
                <div id="previewContainer" class="preview-box flex-1">
                    <div class="text-gray-400 text-xs text-center italic">
                        Selecione √≠cones
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="action-panel">
                <div class="flex flex-col gap-2">
                    <button id="generateBtn" onclick="generateFiles()" disabled class="btn btn-primary w-full">
                        Gerar Arquivos DTF UV
                    </button>
                    <button onclick="clearSelection()" class="btn btn-secondary w-full">
                        Limpar Sele√ß√£o
                    </button>
                </div>
                <p class="text-xs text-gray-500 mt-3 text-center">
                    <span id="selectedCount">0</span> √≠cones selecionados
                </p>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Search -->
            <div class="mb-4">
                <input type="text" id="searchInput" onkeyup="filterLanguages()"
                    class="search-input" placeholder="üîç Buscar √≠cone...">
            </div>

            <!-- Info Compacto -->
            <div class="bg-[#1e1933] border border-[#2d2640] rounded-lg p-4 mb-4">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-primary text-lg">‚ÑπÔ∏è</span>
                    <h3 class="text-sm font-bold text-white">DTF UV - Alto Relevo 3D</h3>
                </div>
                <p class="text-xs text-gray-400 leading-relaxed">
                    Gera 3 arquivos por folha: <strong class="text-white">CORES</strong> (CMYK colorido),
                    <strong class="text-white">BRANCO</strong> (camada base opaca) e
                    <strong class="text-white">VERNIZ</strong> (relevo UV 3D).
                    Envie todos para a gr√°fica DTF UV.
                </p>
            </div>

            <!-- Icons Grid -->
            <div id="languagesContainer"></div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="bg-[#1e1933] border border-[#2d2640] rounded-xl p-8 text-center max-w-sm">
            <div class="spinner mx-auto mb-4"></div>
            <h3 id="loadingText" class="text-white text-base font-bold mb-2">Baixando √≠cones...</h3>
            <p id="loadingProgress" class="text-gray-400 text-sm"></p>
        </div>
    </div>

    <script>
        const languagesData = {
            "üî• Top 20": [
                { name: "Python", devicon: "python", color: "#3776ab" },
                { name: "JavaScript", devicon: "javascript", color: "#f7df1e" },
                { name: "Java", devicon: "java", color: "#007396" },
                { name: "TypeScript", devicon: "typescript", color: "#3178c6" },
                { name: "C++", devicon: "cplusplus", color: "#00599c" },
                { name: "C#", devicon: "csharp", color: "#239120" },
                { name: "PHP", devicon: "php", color: "#777bb4" },
                { name: "C", devicon: "c", color: "#a8b9cc" },
                { name: "Ruby", devicon: "ruby", color: "#cc342d" },
                { name: "Go", devicon: "go", color: "#00add8" },
                { name: "Swift", devicon: "swift", color: "#fa7343" },
                { name: "Kotlin", devicon: "kotlin", color: "#7f52ff" },
                { name: "Rust", devicon: "rust", color: "#ce422b" },
                { name: "Scala", devicon: "scala", color: "#dc322f" },
                { name: "R", devicon: "r", color: "#276dc3" },
                { name: "Dart", devicon: "dart", color: "#0175c2" },
                { name: "Perl", devicon: "perl", color: "#39457e" },
                { name: "Lua", devicon: "lua", color: "#000080" },
                { name: "Groovy", devicon: "groovy", color: "#4298b8" },
                { name: "Julia", devicon: "julia", color: "#9558b2" }
            ],
            "üåê Web": [
                { name: "HTML5", devicon: "html5", color: "#e34f26" },
                { name: "CSS3", devicon: "css3", color: "#1572b6" },
                { name: "Sass", devicon: "sass", color: "#cc6699" },
                { name: "Less", devicon: "less", color: "#1d365d" },
                { name: "Bootstrap", devicon: "bootstrap", color: "#7952b3" },
                { name: "Tailwind CSS", devicon: "tailwindcss", color: "#06b6d4" },
                { name: "React", devicon: "react", color: "#61dafb" },
                { name: "Vue.js", devicon: "vuejs", color: "#4fc08d" },
                { name: "Angular", devicon: "angularjs", color: "#dd0031" },
                { name: "Svelte", devicon: "svelte", color: "#ff3e00" },
                { name: "jQuery", devicon: "jquery", color: "#0769ad" },
                { name: "Webpack", devicon: "webpack", color: "#8dd6f9" },
                { name: "Babel", devicon: "babel", color: "#f9dc3e" },
                { name: "Vite", devicon: "vitejs", color: "#646cff" },
                { name: "Gatsby", devicon: "gatsby", color: "#663399" }
            ],
            "‚öôÔ∏è Backend": [
                { name: "Node.js", devicon: "nodejs", color: "#339933" },
                { name: "Express", devicon: "express", color: "#000000" },
                { name: "Next.js", devicon: "nextjs", color: "#000000" },
                { name: "Nuxt.js", devicon: "nuxtjs", color: "#00c58e" },
                { name: "NestJS", devicon: "nestjs", color: "#e0234e" },
                { name: "Django", devicon: "django", color: "#092e20" },
                { name: "Flask", devicon: "flask", color: "#000000" },
                { name: "Spring", devicon: "spring", color: "#6db33f" },
                { name: ".NET", devicon: "dot-net", color: "#512bd4" },
                { name: "Laravel", devicon: "laravel", color: "#ff2d20" },
                { name: "Symfony", devicon: "symfony", color: "#000000" },
                { name: "Rails", devicon: "rails", color: "#cc0000" },
                { name: "Phoenix", devicon: "phoenix", color: "#fd4f00" },
                { name: "GraphQL", devicon: "graphql", color: "#e10098" },
                { name: "Apollo", devicon: "apollographql", color: "#311c87" }
            ],
            "üíæ Databases": [
                { name: "MySQL", devicon: "mysql", color: "#4479a1" },
                { name: "PostgreSQL", devicon: "postgresql", color: "#336791" },
                { name: "SQLite", devicon: "sqlite", color: "#003b57" },
                { name: "Microsoft SQL", devicon: "microsoftsqlserver", color: "#cc2927" },
                { name: "Oracle", devicon: "oracle", color: "#f80000" },
                { name: "MongoDB", devicon: "mongodb", color: "#47a248" },
                { name: "Redis", devicon: "redis", color: "#dc382d" },
                { name: "Firebase", devicon: "firebase", color: "#ffca28" },
                { name: "Supabase", devicon: "supabase", color: "#3ecf8e" },
                { name: "Cassandra", devicon: "cassandra", color: "#1287b1" },
                { name: "CouchDB", devicon: "couchdb", color: "#e42528" },
                { name: "Neo4j", devicon: "neo4j", color: "#008cc1" }
            ],
            "‚òÅÔ∏è DevOps": [
                { name: "Docker", devicon: "docker", color: "#2496ed" },
                { name: "Kubernetes", devicon: "kubernetes", color: "#326ce5" },
                { name: "AWS", devicon: "amazonwebservices", color: "#232f3e" },
                { name: "Google Cloud", devicon: "googlecloud", color: "#4285f4" },
                { name: "Azure", devicon: "azure", color: "#0089d6" },
                { name: "Heroku", devicon: "heroku", color: "#430098" },
                { name: "Vercel", devicon: "vercel", color: "#000000" },
                { name: "Netlify", devicon: "netlify", color: "#00c7b7" },
                { name: "DigitalOcean", devicon: "digitalocean", color: "#0080ff" },
                { name: "Terraform", devicon: "terraform", color: "#7b42bc" },
                { name: "Ansible", devicon: "ansible", color: "#ee0000" },
                { name: "Jenkins", devicon: "jenkins", color: "#d24939" },
                { name: "Git", devicon: "git", color: "#f05032" },
                { name: "GitHub", devicon: "github", color: "#181717" },
                { name: "GitLab", devicon: "gitlab", color: "#fca121" },
                { name: "Nginx", devicon: "nginx", color: "#009639" },
                { name: "Apache", devicon: "apache", color: "#d22128" }
            ],
            "üêß Linux": [
                { name: "Linux", devicon: "linux", color: "#fcc624" },
                { name: "Ubuntu", devicon: "ubuntu", color: "#e95420" },
                { name: "Debian", devicon: "debian", color: "#a80030" },
                { name: "Fedora", devicon: "fedora", color: "#51a2da" },
                { name: "Arch Linux", devicon: "archlinux", color: "#1793d1" },
                { name: "CentOS", devicon: "centos", color: "#212429" },
                { name: "Kali Linux", devicon: "kalilinux", color: "#557c94" },
                { name: "Manjaro", devicon: "manjaro", color: "#35bf5c" },
                { name: "Raspberry Pi", devicon: "raspberrypi", color: "#c51a4a" },
                { name: "Red Hat", devicon: "redhat", color: "#ee0000" }
            ],
            "üõ†Ô∏è Ferramentas": [
                { name: "VS Code", devicon: "vscode", color: "#007acc" },
                { name: "Vim", devicon: "vim", color: "#019733" },
                { name: "NPM", devicon: "npm", color: "#cb3837" },
                { name: "Yarn", devicon: "yarn", color: "#2c8ebb" },
                { name: "ESLint", devicon: "eslint", color: "#4b32c3" },
                { name: "Jest", devicon: "jest", color: "#c21325" },
                { name: "Figma", devicon: "figma", color: "#f24e1e" },
                { name: "Postman", devicon: "postman", color: "#ff6c37" },
                { name: "Jira", devicon: "jira", color: "#0052cc" },
                { name: "Trello", devicon: "trello", color: "#0079bf" }
            ],
            "üì± Mobile": [
                { name: "Android", devicon: "android", color: "#3ddc84" },
                { name: "Flutter", devicon: "flutter", color: "#02569b" },
                { name: "React Native", devicon: "react", color: "#61dafb" },
                { name: "Electron", devicon: "electron", color: "#47848f" },
                { name: "Apple", devicon: "apple", color: "#000000" }
            ],
            "üß† IA & Data": [
                { name: "TensorFlow", devicon: "tensorflow", color: "#ff6f00" },
                { name: "PyTorch", devicon: "pytorch", color: "#ee4c2c" },
                { name: "Pandas", devicon: "pandas", color: "#150458" },
                { name: "NumPy", devicon: "numpy", color: "#013243" },
                { name: "Jupyter", devicon: "jupyter", color: "#f37626" },
                { name: "Keras", devicon: "keras", color: "#d00000" },
                { name: "OpenAI", devicon: "chatgpt", color: "#74aa9c" },
                { name: "Anaconda", devicon: "anaconda", color: "#44a833" }
            ]
        };

        let selectedLanguages = new Map();

        function renderLanguages() {
            const container = document.getElementById('languagesContainer');
            container.innerHTML = '';

            for (const [category, languages] of Object.entries(languagesData)) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'mb-6';

                categoryDiv.innerHTML = `
                    <div class="category-header">
                        <h3 class="text-sm font-bold text-white">${category}</h3>
                        <div class="flex items-center gap-2">
                            <span class="text-xs text-gray-400">${languages.length}</span>
                            <button onclick="selectCategory('${category}', event)" class="btn btn-secondary text-xs py-1 px-3">
                                Selecionar
                            </button>
                        </div>
                    </div>
                `;

                const grid = document.createElement('div');
                grid.className = 'grid grid-cols-[repeat(auto-fill,minmax(90px,1fr))] gap-2';

                languages.forEach((lang, index) => {
                    const langId = `${category.replace(/\s/g, '-')}-${index}`;
                    const iconUrl = `https://cdn.jsdelivr.net/gh/devicons/devicon/icons/${lang.devicon}/${lang.devicon}-original.svg`;

                    const card = document.createElement('div');
                    card.className = 'icon-card';
                    card.dataset.name = lang.name.toLowerCase();
                    card.dataset.category = category;
                    card.dataset.langid = langId;
                    card.dataset.langData = JSON.stringify(lang);
                    card.onclick = () => toggleSelection(card, lang);

                    card.innerHTML = `
                        <img src="${iconUrl}" alt="${lang.name}">
                        <p class="text-white text-xs font-semibold text-center leading-tight">${lang.name}</p>
                        <div class="quantity-input w-full">
                            <label class="text-xs text-gray-400">Qtd:</label>
                            <input type="number" id="qty-${langId}" min="1" value="1"
                                onchange="updateIconQuantity('${langId}', this.value)"
                                onclick="event.stopPropagation()">
                        </div>
                    `;

                    grid.appendChild(card);
                });

                categoryDiv.appendChild(grid);
                container.appendChild(categoryDiv);
            }

            for (const [langId, quantity] of selectedLanguages.entries()) {
                const card = document.querySelector(`[data-langid="${langId}"]`);
                if (card) {
                    card.classList.add('selected');
                    const qtyInput = card.querySelector(`#qty-${langId}`);
                    if (qtyInput) qtyInput.value = quantity;
                }
            }

            updateStats();
            updatePreview();
        }

        function toggleSelection(card, lang) {
            const langId = card.dataset.langid;
            const qtyInput = card.querySelector(`#qty-${langId}`);

            if (selectedLanguages.has(langId)) {
                selectedLanguages.delete(langId);
                card.classList.remove('selected');
                if (qtyInput) qtyInput.value = 1;
            } else {
                selectedLanguages.set(langId, 1);
                card.classList.add('selected');
                if (qtyInput) qtyInput.value = 1;
            }

            updateStats();
            updatePreview();
        }

        function updateIconQuantity(langId, quantity) {
            if (selectedLanguages.has(langId)) {
                const qty = parseInt(quantity);
                if (qty > 0) {
                    selectedLanguages.set(langId, qty);
                } else {
                    document.querySelector(`[data-langid="${langId}"]`).click();
                }
            }
            updateStats();
            updatePreview();
        }

        function selectCategory(category, event) {
            event.stopPropagation();
            const cards = document.querySelectorAll(`[data-category="${category}"]`);
            const allSelected = Array.from(cards).every(card => selectedLanguages.has(card.dataset.langid));

            cards.forEach(card => {
                const langId = card.dataset.langid;
                const qtyInput = card.querySelector(`#qty-${langId}`);

                if (allSelected) {
                    selectedLanguages.delete(langId);
                    card.classList.remove('selected');
                    if (qtyInput) qtyInput.value = 1;
                } else {
                    selectedLanguages.set(langId, 1);
                    card.classList.add('selected');
                    if (qtyInput) qtyInput.value = 1;
                }
            });

            updateStats();
            updatePreview();
        }

        function clearSelection() {
            selectedLanguages.clear();
            document.querySelectorAll('[data-langid]').forEach(card => {
                card.classList.remove('selected');
                const qtyInput = card.querySelector('input[type="number"]');
                if (qtyInput) qtyInput.value = 1;
            });
            updateStats();
            updatePreview();
        }

        function updateStats() {
            const count = selectedLanguages.size;
            let totalStickers = 0;
            selectedLanguages.forEach(quantity => {
                totalStickers += quantity;
            });

            document.getElementById('selectedCount').textContent = count;
            document.getElementById('selectedIcons').textContent = count;
            document.getElementById('totalStickers').textContent = totalStickers;

            const stickerSize = parseInt(document.getElementById('stickerSize').value);
            const spacing = parseInt(document.getElementById('spacing').value);
            const maxFit = calculateMaxFit(stickerSize, spacing);
            document.getElementById('maxFit').textContent = maxFit;

            const sheetsNeeded = Math.ceil(totalStickers / maxFit);
            document.getElementById('sheetsNeeded').textContent = totalStickers > 0 ? sheetsNeeded : 0;

            document.getElementById('generateBtn').disabled = count === 0;
        }

        function calculateMaxFit(stickerSize, spacing) {
            const a4Width = 210;
            const a4Height = 297;
            const margin = 10;

            const cellSize = stickerSize + spacing;
            const cols = Math.floor((a4Width - 2 * margin) / cellSize);
            const rows = Math.floor((a4Height - 2 * margin) / cellSize);

            return cols * rows;
        }

        function filterLanguages() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('[data-langid]').forEach(card => {
                card.style.display = card.dataset.name.includes(searchTerm) ? 'flex' : 'none';
            });
        }

        async function updatePreview() {
            const previewContainer = document.getElementById('previewContainer');
            if (selectedLanguages.size === 0) {
                previewContainer.innerHTML = `
                    <div class="text-gray-400 text-xs text-center italic">
                        Selecione √≠cones
                    </div>`;
                return;
            }

            previewContainer.innerHTML = `
                <div class="text-gray-400 text-xs text-center italic">
                    Gerando...
                </div>`;

            try {
                const stickerSize = parseInt(document.getElementById('stickerSize').value);
                const spacing = parseInt(document.getElementById('spacing').value);
                const shape = document.getElementById('stickerShape').value;
                const maxFit = calculateMaxFit(stickerSize, spacing);

                const uniqueSelectedLangIds = Array.from(selectedLanguages.keys());
                const iconsData = await fetchAllIcons(uniqueSelectedLangIds, false);

                const expandedArray = [];
                selectedLanguages.forEach((quantity, langId) => {
                    for (let i = 0; i < quantity; i++) {
                        expandedArray.push(langId);
                    }
                });

                const svgPreview = await generateSheetSVG(0, stickerSize, spacing, shape, maxFit, iconsData, 'cores', expandedArray);
                previewContainer.innerHTML = svgPreview;
            } catch (error) {
                console.error("Erro ao gerar preview:", error);
                previewContainer.innerHTML = `<div class="text-red-400 text-xs text-center">Erro</div>`;
            }
        }

        async function generateFiles() {
            const overlay = document.getElementById('loadingOverlay');
            overlay.classList.add('active');

            try {
                const stickerSize = parseInt(document.getElementById('stickerSize').value);
                const spacing = parseInt(document.getElementById('spacing').value);
                const shape = document.getElementById('stickerShape').value;
                const maxFit = calculateMaxFit(stickerSize, spacing);

                const uniqueSelectedLangIds = Array.from(selectedLanguages.keys());
                const iconsData = await fetchAllIcons(uniqueSelectedLangIds, true);

                const expandedArray = [];
                selectedLanguages.forEach((quantity, langId) => {
                    for (let i = 0; i < quantity; i++) {
                        expandedArray.push(langId);
                    }
                });
                const totalSheets = Math.ceil(expandedArray.length / maxFit);

                document.getElementById('loadingText').textContent = 'Gerando arquivos DTF UV...';

                for (let sheet = 0; sheet < totalSheets; sheet++) {
                    const svgCores = await generateSheetSVG(sheet, stickerSize, spacing, shape, maxFit, iconsData, 'cores', expandedArray);
                    downloadFile(`adesivos-CORES-sheet${sheet + 1}-de-${totalSheets}.svg`, svgCores, 'image/svg+xml');

                    const svgBranco = await generateSheetSVG(sheet, stickerSize, spacing, shape, maxFit, iconsData, 'branco', expandedArray);
                    downloadFile(`adesivos-BRANCO-sheet${sheet + 1}-de-${totalSheets}.svg`, svgBranco, 'image/svg+xml');

                    const svgVerniz = await generateSheetSVG(sheet, stickerSize, spacing, shape, maxFit, iconsData, 'verniz', expandedArray);
                    downloadFile(`adesivos-VERNIZ-sheet${sheet + 1}-de-${totalSheets}.svg`, svgVerniz, 'image/svg+xml');
                }

                const totalFiles = totalSheets * 3;
                const uniqueIcons = selectedLanguages.size;
                const totalStickers = expandedArray.length;

                alert(`‚úÖ ${totalFiles} arquivo(s) SVG gerado(s)!\n\nüìä ${uniqueIcons} √≠cone(s) √∫nico(s) = ${totalStickers} adesivo(s)\nüé® CORES: Impress√£o CMYK\n‚ö™ BRANCO: Camada base\n‚ú® VERNIZ: Relevo UV 3D\n\nEnvie os 3 arquivos para gr√°fica!`);
            } finally {
                overlay.classList.remove('active');
            }
        }

        async function fetchAllIcons(selectedArray, showLoading = true) {
            const iconsData = {};
            const total = selectedArray.length;

            if (showLoading) {
                document.getElementById('loadingText').textContent = 'Baixando √≠cones...';
            }

            for (let i = 0; i < selectedArray.length; i++) {
                const langId = selectedArray[i];
                const card = document.querySelector(`[data-langid="${langId}"]`);
                if (!card) continue;

                const lang = JSON.parse(card.dataset.langData || '{}');
                if (!lang.devicon) {
                    iconsData[langId] = { lang, svgText: null };
                    continue;
                }

                const iconUrl = `https://cdn.jsdelivr.net/gh/devicons/devicon/icons/${lang.devicon}/${lang.devicon}-original.svg`;

                if (showLoading) {
                    document.getElementById('loadingProgress').textContent = `${lang.name} (${i + 1}/${total})`;
                }

                try {
                    const response = await fetch(iconUrl);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    const svgText = await response.text();
                    iconsData[langId] = { lang, svgText };
                } catch (error) {
                    console.error(`Erro ao buscar ${lang.name}:`, error);
                    iconsData[langId] = { lang, svgText: null };
                }
            }

            if (showLoading) {
                document.getElementById('loadingText').textContent = 'Gerando SVG...';
                document.getElementById('loadingProgress').textContent = '';
            }

            return iconsData;
        }

        function getSanitizedSvgContent(svgText) {
            if (!svgText) return '';
            try {
                const parser = new DOMParser();
                const svgDoc = parser.parseFromString(svgText, 'image/svg+xml');
                const svgElement = svgDoc.querySelector('svg');
                if (!svgElement) return '';

                svgElement.querySelectorAll('*').forEach(el => {
                    el.removeAttribute('fill');
                    el.removeAttribute('stroke');
                });
                return svgElement.innerHTML;
            } catch (e) { return ''; }
        }

        function generateSheetSVG(sheetIndex, stickerSize, spacing, shape, maxFit, iconsData, layerType = 'cores', expandedArray) {
            const start = sheetIndex * maxFit;
            const end = Math.min(start + maxFit, expandedArray.length);
            const sheetLanguages = expandedArray.slice(start, end);

            const a4Width = 210;
            const a4Height = 297;
            const margin = 10;
            const cellSize = stickerSize + spacing;
            const cols = Math.floor((a4Width - 2 * margin) / cellSize);

            const layerConfig = {
                cores: {
                    title: `Adesivos CORES (CMYK) - Folha ${sheetIndex + 1}`,
                    bgColor: 'white',
                    description: 'Camada de impress√£o colorida - Enviar para impressora CMYK'
                },
                branco: {
                    title: `Adesivos BRANCO (White Layer) - Folha ${sheetIndex + 1}`,
                    bgColor: 'black',
                    description: 'Camada de tinta branca - Define base opaca para cores'
                },
                verniz: {
                    title: `Adesivos VERNIZ (UV Relief) - Folha ${sheetIndex + 1}`,
                    bgColor: 'black',
                    description: 'Camada de verniz UV - Define √°reas com efeito 3D em alto relevo'
                }
            };

            const config = layerConfig[layerType];

            let svg = `<?xml version="1.0" encoding="UTF-8"?>
<svg width="${a4Width}mm" height="${a4Height}mm" viewBox="0 0 ${a4Width} ${a4Height}" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <title>${config.title}</title>
  <desc>${config.description}</desc>
  <rect width="${a4Width}" height="${a4Height}" fill="${config.bgColor}"/>
`;

            let defs = '\n  <defs>';
            sheetLanguages.forEach((langId) => {
                const iconData = iconsData[langId];
                if (!iconData || !iconData.svgText) return;

                const parser = new DOMParser();
                const svgDoc = parser.parseFromString(iconData.svgText, 'image/svg+xml');
                const svgElement = svgDoc.querySelector('svg');

                if (svgElement) {
                    const viewBox = svgElement.getAttribute('viewBox') || '0 0 128 128';
                    const innerHTML = (layerType === 'cores') ? svgElement.innerHTML : getSanitizedSvgContent(iconData.svgText);
                    const iconId = langId.replace(/[^a-zA-Z0-9]/g, '-');
                    defs += `\n    <symbol id="icon-${iconId}" viewBox="${viewBox}">${innerHTML}</symbol>`;
                }
            });
            defs += '\n  </defs>';
            svg += defs;

            sheetLanguages.forEach((langId, index) => {
                const iconData = iconsData[langId];
                if (!iconData) return;

                const lang = iconData.lang;
                if (!lang) return;

                const row = Math.floor(index / cols);
                const col = index % cols;
                const x = margin + (col * cellSize) + (cellSize / 2);
                const y = margin + (row * cellSize) + (cellSize / 2);

                const iconSize = stickerSize;
                const iconId = `icon-${langId.replace(/[^a-zA-Z0-9]/g, '-')}`;

                svg += `\n  <g transform="translate(${x}, ${y})">`;

                if (iconData.svgText) {
                    const fillColor = (layerType === 'branco' || layerType === 'verniz') ? 'fill="white"' : '';
                    svg += `\n    <svg x="${-iconSize / 2}" y="${-iconSize / 2}" width="${iconSize}" height="${iconSize}" preserveAspectRatio="xMidYMid meet">`;
                    svg += `\n      <use href="#${iconId}" width="100%" height="100%" ${fillColor}/>`;
                    svg += `\n    </svg>`;
                } else {
                    const fontSize = stickerSize / 8;
                    svg += `\n    <text x="0" y="${fontSize / 3}" text-anchor="middle" font-size="${fontSize}" font-weight="bold" fill="${(layerType === 'cores') ? (lang.color || '#666') : 'white'}">${lang.name}</text>`;
                }

                svg += `\n  </g>`;
            });

            svg += `\n</svg>`;
            return svg;
        }

        function downloadFile(filename, content, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        window.addEventListener('DOMContentLoaded', renderLanguages);
        window.addEventListener('DOMContentLoaded', updateStats);
    </script>
</body>

</html>
